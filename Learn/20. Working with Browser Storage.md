# Working with Browser Storage

In this course, you will learn about:

- Local Storage
- Session
- Cookies
- IndexDB

## Local Storage

Let's start with local storage. Local storage is a great, easy to use key-value storage where we can store basic data.

We can access to the local storage with by just typing `localStorage`. It's part of the `window` object, but as you learned, we can omit this.

We can set a local storage with `setItem()` method, for example:

```js
const userId = "u123";
localStorage.setItem("uid", userId);
```

If you go to the **Application** tab in browser developer tools, you see the key-value data in local storage.

We can also delete (with `delete` or `backspace` key) and edit this data in local storage.

Now we can get an item from the local storage with `getItem()` method, for example:

```js
const storeBtn = document.getElementById("store-btn");
const retrBtn = document.getElementById("retrieve-btn");

const userId = "u123";

storeBtn.addEventListener("click", () => localStorage.setItem("uid", userId));
retrBtn.addEventListener("click", () => {
  const extractedId = localStorage.getItem("uid");

  if (extractedId) {
    console.log(`Got the id - ${extractedId}`);
  } else {
    console.log("Couldn't find id!");
  }
});
```

**Important**: We can't use object directly in local storage. By default, some data convert into the string (like `userId.toString()`); and for **object**, it doesn't give us human readable or machine readable version of the object. Instead, it gives us `[Object, object]`, for example:

```js
const storeBtn = document.getElementById("store-btn");
const retrBtn = document.getElementById("retrieve-btn");

const user = {
  name: "Hamid",
  age: 23,
  hobbies: ["Programming", "Gaming"],
};

storeBtn.addEventListener("click", () => {
  localStorage.setItem("user", user);
});
retrBtn.addEventListener("click", () => {
  localStorage.getItem("user");
});

// output
key: user | value: [object Object]
```

We can convert this to JSON, because JSON actually is a string. **JSON data is string data**. So we can use `JSON.stringify()` and `JSON.parse()` methods:

```js
const storeBtn = document.getElementById("store-btn");
const retrBtn = document.getElementById("retrieve-btn");

const user = {
  name: "Hamid",
  age: 23,
  hobbies: ["Programming", "Gaming"],
};

storeBtn.addEventListener("click", () => {
  localStorage.setItem("user", JSON.stringify(user));
});
retrBtn.addEventListener("click", () => {
  JSON.parse(localStorage.getItem("user"));
});

// output
key: user | value: "{"name":"Hamid","age":23,"hobbies":["Programming","Gaming"]}"
```

## Session

We can use the session for our browser. We can do this easily with `sessionStorage`.

What is session storage? Session storage data lives as long as our page is open in the browser; so as long as we have it in an active tab even if we reload the page. Thereafter if we close that tab or clase all tabs where our application is running or a close the entire browser, session storage is cleared. Instead, local storage servives this; local storage is never cleared unless the user clears it manually or the browser clears it (because it's running out of space or anything like that). For example:

```js
const storeBtn = document.getElementById("store-btn");
const retrBtn = document.getElementById("retrieve-btn");

const user = {
  name: "Hamid",
  age: 23,
  hobbies: ["Programming", "Gaming"],
};

storeBtn.addEventListener("click", () => {
  sessionStorage.setItem("user", JSON.stringify(user));
});
retrBtn.addEventListener("click", () => {
  JSON.parse(sessionStorage.getItem("user"));
});
```

## Cookies

Unlike local storage and session storage, cookies only are available if our web page is geting served with a real server:

```js
const storeBtn = document.getElementById("store-btn");
const userId = "u123";

storeBtn.addEventListener("click", () => {
  document.cookie = `uid=${userId}`;
});
```

You need to install **NodeJS** app in your computer. Then use `npm install -g serve` command for install a custom web server. You can use it with `serve` command in **NodeJS**. Or you can use google chrome web server plugin to use it.

We can see or get our cookie easily with `document.cookie` code, for example:

```js
const storeBtn = document.getElementById("store-btn");
const retrBtn = document.getElementById("retrieve-btn");

const userId = "u123";

storeBtn.addEventListener("click", () => {
  document.cookie = `uid=${userId}`;
});
retrBtn.addEventListener("click", () => {
  console.log(document.cookie); // "u123"
});

// output
key: uid | value: u123
```

If we add multiple cookies, they will not override the before cookie. For example:

```js
const storeBtn = document.getElementById("store-btn");
const retrBtn = document.getElementById("retrieve-btn");

const user = {
  name: "Hamid",
  age: 23,
  hobbies: ["Programming", "Gaming"],
};

const userId = "u123";

storeBtn.addEventListener("click", () => {
  document.cookie = `uid=${userId}`;
  document.cookie = `user=${JSON.stringify(user)}`;
});
retrBtn.addEventListener("click", () => {
  console.log(document.cookie);
  /*
  uid=u123; user={"name":"Hamid","age":23,"hobbies":["Programming","Gaming"]}
  */
});
```

As you can see, we have two cookies in one line with a `;` separator. We can put it into an array with `split()` method:

```js
const storeBtn = document.getElementById("store-btn");
const retrBtn = document.getElementById("retrieve-btn");

const user = {
  name: "Hamid",
  age: 23,
  hobbies: ["Programming", "Gaming"],
};

const userId = "u123";

storeBtn.addEventListener("click", () => {
  document.cookie = `uid=${userId}`;
  document.cookie = `user=${JSON.stringify(user)}`;
});
retrBtn.addEventListener("click", () => {
  console.log(document.cookie.split(";"));
});

/*
(2) ["uid=u123", " user={"name":"Hamid","age":23,"hobbies":["Programming","Gaming"]}"]
  0: "uid=u123"
  1: " user={"name":"Hamid","age":23,"hobbies":["Programming","Gaming"]}"
  length: 2
  __proto__: Array(0)
*/
```

See? There is a empty space before the `user` key because of adding a new cookie. We can remove it with `trim()` method. We must get all keys with `map()` method:

```js
const storeBtn = document.getElementById("store-btn");
const retrBtn = document.getElementById("retrieve-btn");

const user = {
  name: "Hamid",
  age: 23,
  hobbies: ["Programming", "Gaming"],
};

const userId = "u123";

storeBtn.addEventListener("click", () => {
  document.cookie = `uid=${userId}`;
  document.cookie = `user=${JSON.stringify(user)}`;
});
retrBtn.addEventListener("click", () => {
  const cookieData = document.cookie.split(";");
  const data = cookieData.map((item) => item.trim());
  console.log(data);
});

/*
(2) ["uid=u123", "user={"name":"Hamid","age":23,"hobbies":["Programming","Gaming"]}"]
  0: "uid=u123"
  1: "user={"name":"Hamid","age":23,"hobbies":["Programming","Gaming"]}"
  length: 2
  __proto__: Array(0)
*/
```

We can set an expiration time for our cookies with `max-age`. `max-age` is based on seconds (i.e `4` is four seconds):

```js
const storeBtn = document.getElementById("store-btn");
const retrBtn = document.getElementById("retrieve-btn");

const userId = "u123";

storeBtn.addEventListener("click", () => {
  document.cookie = `uid=${userId}; max-age=10`;
});
retrBtn.addEventListener("click", () => {
  console.log(document.cookie);
});

// output
key: uid | value: u123 => expiration date: 10 seconds later
```

So that's `max-age`. The alternative to that is that we set `expires` to a value and `expires` takes a date. That date needs to have a certain format.

```js
document.cookie = `uid=${userId}; expires=Fri, 31 Dec 9999 23:59:59 GMT`;
```

More on Cookies: <https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie>
